(function() {
  var Git, cache, findRepo, getCache, getCommit, getCommitMessage, setCache, showOpts;

  findRepo = require('./find-repo');

  Git = require('git-wrapper');

  showOpts = {
    s: true,
    format: '%ce####%s####%cn####%b'
  };

  cache = {};

  getCache = function(file, hash) {
    return cache["" + file + "|" + hash] || null;
  };

  setCache = function(file, hash, msg) {
    return cache["" + file + "|" + hash] = msg;
  };

  getCommitMessage = function(file, hash, callback) {
    var git, repoPath;
    repoPath = findRepo(file);
    if (!repoPath) {
      return;
    }
    git = new Git({
      'git-dir': repoPath
    });
    return git.exec('show', showOpts, [hash], function(error, msg) {
      if (error) {
        return;
      }
      return callback(msg);
    });
  };

  getCommit = function(file, hash, callback) {
    var cached;
    cached = getCache(file, hash);
    if (cached) {
      return callback(cached);
    }
    return getCommitMessage(file, hash, function(msg) {
      var commit, lines;
      lines = msg.split(/####/g);
      commit = {
        email: lines.shift(),
        subject: lines.shift(),
        author: lines.shift(),
        message: lines.join('\n').replace(/(^\s+|\s+$)/g, '')
      };
      setCache(file, hash, commit);
      return callback(commit);
    });
  };

  module.exports = getCommit;

}).call(this);

//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICIiLAogICJzb3VyY2VSb290IjogIiIsCiAgInNvdXJjZXMiOiBbCiAgICAiL1VzZXJzL2tzd2VkYmVyZy9kb3RmaWxlcy8uYXRvbS9wYWNrYWdlcy9ibGFtZS9saWIvdXRpbHMvZ2V0LWNvbW1pdC5jb2ZmZWUiCiAgXSwKICAibmFtZXMiOiBbXSwKICAibWFwcGluZ3MiOiAiQUFBQTtBQUFBLE1BQUEsK0VBQUE7O0FBQUEsRUFBQSxRQUFBLEdBQVcsT0FBQSxDQUFRLGFBQVIsQ0FBWCxDQUFBOztBQUFBLEVBQ0EsR0FBQSxHQUFNLE9BQUEsQ0FBUSxhQUFSLENBRE4sQ0FBQTs7QUFBQSxFQUdBLFFBQUEsR0FDRTtBQUFBLElBQUEsQ0FBQSxFQUFHLElBQUg7QUFBQSxJQUNBLE1BQUEsRUFBUSx3QkFEUjtHQUpGLENBQUE7O0FBQUEsRUFPQSxLQUFBLEdBQVEsRUFQUixDQUFBOztBQUFBLEVBU0EsUUFBQSxHQUFXLFNBQUMsSUFBRCxFQUFPLElBQVAsR0FBQTtXQUNULEtBQU0sQ0FBQSxFQUFBLEdBQUcsSUFBSCxHQUFRLEdBQVIsR0FBVyxJQUFYLENBQU4sSUFBNEIsS0FEbkI7RUFBQSxDQVRYLENBQUE7O0FBQUEsRUFZQSxRQUFBLEdBQVcsU0FBQyxJQUFELEVBQU8sSUFBUCxFQUFhLEdBQWIsR0FBQTtXQUNULEtBQU0sQ0FBQSxFQUFBLEdBQUcsSUFBSCxHQUFRLEdBQVIsR0FBVyxJQUFYLENBQU4sR0FBMkIsSUFEbEI7RUFBQSxDQVpYLENBQUE7O0FBQUEsRUFlQSxnQkFBQSxHQUFtQixTQUFDLElBQUQsRUFBTyxJQUFQLEVBQWEsUUFBYixHQUFBO0FBQ2pCLFFBQUEsYUFBQTtBQUFBLElBQUEsUUFBQSxHQUFXLFFBQUEsQ0FBUyxJQUFULENBQVgsQ0FBQTtBQUVBLElBQUEsSUFBQSxDQUFBLFFBQUE7QUFBQSxZQUFBLENBQUE7S0FGQTtBQUFBLElBSUEsR0FBQSxHQUFVLElBQUEsR0FBQSxDQUFJO0FBQUEsTUFBQSxTQUFBLEVBQVcsUUFBWDtLQUFKLENBSlYsQ0FBQTtXQUtBLEdBQUcsQ0FBQyxJQUFKLENBQVMsTUFBVCxFQUFpQixRQUFqQixFQUEyQixDQUFDLElBQUQsQ0FBM0IsRUFBbUMsU0FBQyxLQUFELEVBQVEsR0FBUixHQUFBO0FBQ2pDLE1BQUEsSUFBVSxLQUFWO0FBQUEsY0FBQSxDQUFBO09BQUE7YUFFQSxRQUFBLENBQVMsR0FBVCxFQUhpQztJQUFBLENBQW5DLEVBTmlCO0VBQUEsQ0FmbkIsQ0FBQTs7QUFBQSxFQTBCQSxTQUFBLEdBQVksU0FBQyxJQUFELEVBQU8sSUFBUCxFQUFhLFFBQWIsR0FBQTtBQUNWLFFBQUEsTUFBQTtBQUFBLElBQUEsTUFBQSxHQUFTLFFBQUEsQ0FBUyxJQUFULEVBQWUsSUFBZixDQUFULENBQUE7QUFDQSxJQUFBLElBQTJCLE1BQTNCO0FBQUEsYUFBTyxRQUFBLENBQVMsTUFBVCxDQUFQLENBQUE7S0FEQTtXQUdBLGdCQUFBLENBQWlCLElBQWpCLEVBQXVCLElBQXZCLEVBQTZCLFNBQUMsR0FBRCxHQUFBO0FBRTNCLFVBQUEsYUFBQTtBQUFBLE1BQUEsS0FBQSxHQUFRLEdBQUcsQ0FBQyxLQUFKLENBQVUsT0FBVixDQUFSLENBQUE7QUFBQSxNQUVBLE1BQUEsR0FDRTtBQUFBLFFBQUEsS0FBQSxFQUFPLEtBQUssQ0FBQyxLQUFOLENBQUEsQ0FBUDtBQUFBLFFBQ0EsT0FBQSxFQUFTLEtBQUssQ0FBQyxLQUFOLENBQUEsQ0FEVDtBQUFBLFFBRUEsTUFBQSxFQUFRLEtBQUssQ0FBQyxLQUFOLENBQUEsQ0FGUjtBQUFBLFFBR0EsT0FBQSxFQUFTLEtBQUssQ0FBQyxJQUFOLENBQVcsSUFBWCxDQUFnQixDQUFDLE9BQWpCLENBQXlCLGNBQXpCLEVBQXlDLEVBQXpDLENBSFQ7T0FIRixDQUFBO0FBQUEsTUFRQSxRQUFBLENBQVMsSUFBVCxFQUFlLElBQWYsRUFBcUIsTUFBckIsQ0FSQSxDQUFBO2FBVUEsUUFBQSxDQUFTLE1BQVQsRUFaMkI7SUFBQSxDQUE3QixFQUpVO0VBQUEsQ0ExQlosQ0FBQTs7QUFBQSxFQTZDQSxNQUFNLENBQUMsT0FBUCxHQUFpQixTQTdDakIsQ0FBQTtBQUFBIgp9

//# sourceURL=/Users/kswedberg/dotfiles/.atom/packages/blame/lib/utils/get-commit.coffee
